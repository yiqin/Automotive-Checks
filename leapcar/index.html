<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <script src="cordova.js"></script>
        <script src="kendo/js/jquery.min.js"></script>
        <script src="kendo/js/kendo.mobile.min.js"></script>
        <script src="scripts/lib/everlive.all.min.js"></script>
        <script src="scripts/lib/moment.min.js"></script>
        <script src="scripts/app/identity-provider.js"></script>        
        <script src="scripts/app/main.js" type="text/javascript"></script>

        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
        <link href="styles/main.css" rel="stylesheet" />
    </head>
    
    <body id="notesApp">
        <section data-role="layout" data-id="default">
            <!--View content will render here-->
        </section>
        <!--WELCOME VIEW -->
        <div data-role="view" id="welcome" data-layout="default" class="welcome-scrn form-view" data-model="app.viewModels.login">
            <h1><b>Leap</b><b>Car</b></h1>


            <ol class="group-wrp">
            <p>
                <img src="styles/images/sprite.png", width="260">
            </p>
                
                <li>
                    <span data-role="touch" data-bind="events: { tap: loginWithoutName }" style="display: inline-block">
                        <a data-role="button" class="btn-login-fb btn-big">Let's go !</a>
                    </span>                    
                </li>
            </ol>
                  <p>
                 Make: <select  id="idMake" class="myMake"></select>
                        
                    </p>
            
                    <p>
                        Model: <select  id="idModel" class="myModel"></select>
                        
                    </p>
            
                    <p>
                        Sub Model: <select  id="idSubModel" class="mySubModel"></select>
                        
                    </p>
            
                    <img name="car" id="carImage" width="300">
                       
            		<button type="button" onclick="displayResult()">Display value of selected fruit</button>
  
            <p>
                 Year: <select  id="idYear" class="myYear"></select>
                        
                    </p>
            
        </div>
        
        


<script>
function displayResult()
{
var x=document.getElementById("idMake").selectedIndex;
alert(document.getElementsByTagName("option")[x].value);
}
    
Array.prototype.getById = function(id)
{
    for (var i=0, len=this.length; i<len; i++) 
    {
            if (typeof this[i] != "object") continue;
            if (this[i].id == id) return this[i];
    }
}

var g_apikey = "ykbpsxywt4yqx3hyakgxhmev";


getMake();
    
    //getModels("Chevrolet");
    
function getModels(make)
{
    //$("<option>").html(" ").appendTo(".myModel");
    //var make_name = document.getElementById("idMake").selectedIndex;
    //alert(make_name);
    //var make = "BMW";
    var select = $("select").addClass("model single");
    jQuery.get("http://hearstcars.api.mashery.com/v1/api/vehicles/models-by-make/"+ make +"/json?api_key="+g_apikey, function(data) 
    {
        models = data.vehicles.models;
        makes = data.vehicles.makes;
        for (i in models)
        {
            var model = models[i];
            var make = makes.getById(model.make);
            if (typeof(make) != "undefined" && typeof(make.name) != "undefined")
            {
                $("<option>").addClass("model")
                             .attr("data-id", model.id)
                             .attr("data-name", model.name)
                             .attr("data-make", make.id)
                             .html(make.name + " " + model.name)
                             .appendTo(".myModel");
            }
        }
        $("<option>").html("").prependTo(".myModel");
    });
}
    
function getMake()
{
    $("<option>").html(" ").appendTo(".myMake");
    var select = $("select").addClass("model single");
    jQuery.get("http://hearstcars.api.mashery.com/v1/api/vehicles/makes/all/json?api_key="+g_apikey, function(data) 
    {
        makes = data.vehicles.makes;
        for (i in makes)
        {
            var make = makes[i];
            if (typeof(make) != "undefined" && typeof(make.name) != "undefined")
            {
                $("<option>").addClass("make")
                             .attr("data-name", make.id)
                             .attr("data-make", make.name)
                             .html(make.name)
                             .appendTo(".myMake");
            }
        }
        
    });
}
    
    
    
    function getSubModels(modelID)
    {
       
    var select = $("select").addClass("model single");
    jQuery.get("http://hearstcars.api.mashery.com/v1/api/vehicles/chrome-by-model/"+modelID+"/json?api_key="+ g_apikey, function(data)
    {
        models = data.submodels;
        makes = data.submodels.makes;
        for (i in models)
        {
            var model = models[i];
            var make = model.make;
            if (typeof(make) != "undefined")
            {
                $("<option>").addClass("model")
                             .attr("data-id", model.id)
                             .attr("data-name", model.name)
                             .attr("data-image", model.image)
                             .html(model.name)
                             .appendTo(".mySubModel");
            }
        }
        var found = [];
$("select option").each(function() {
  if($.inArray(this.value, found) != -1) $(this).remove();
  found.push(this.value);
});
         $("<option>").html("").prependTo(".mySubModel");
               });
        
               }
    
    
$(document).ready(function(){
  $('#idMake').change(function() {
      //alert('Handler for .change() called.');
      //alert($(this).val()); 
    $("#idModel option").remove();
      //$("#idModel option").html("").appendTo(".myModel");
      $("#idSubModel option").remove();
      //document.getElementById('carImage').disabled = true;
      $("#carImage").hide();
      //$("#idSubModel option").html("").appendTo(".mySubModel");
    getModels($(this).val());
      //var make_name = document.getElementById("idMake").selectedIndex;
      //alert(make_name);
  });
  $('#idModel').change(function() {
      //alert('Handler for .change() called.');
      var optionSelected = $(this).find('option:selected').attr('data-id');
      //alert(optionSelected);//this will show the value of the atribute of that option.
      //alert($(this).val());
      //alert($(this).val('data-id'));
    $("#idSubModel option").remove();
      $("#carImage").hide();
      //$("#idSubModel option").html("").appendTo(".mySubModel");
    getSubModels(optionSelected);
      
      //var make_name = document.getElementById("idMake").selectedIndex;
      //alert(make_name);
  });
     $('#idSubModel').change(function() {
      //alert('Handler for .change() called.');
      var optionSelected = $(this).find('option:selected').attr('data-image');
         //alert(optionSelected);//this will show the value of the atribute of that option.
        $("#carImage").show();
    var pic1 = document.getElementById("carImage"); 
    if (pic1 == typeof('undefined')) return;
    pic1.src = optionSelected;
  });
    
    
});
    
    
</script>
    
            

        
        
        
    </body>
    
</html>