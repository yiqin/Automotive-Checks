<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <script src="cordova.js"></script>
        <script src="kendo/js/jquery.min.js"></script>
        <script src="kendo/js/kendo.mobile.min.js"></script>
        <script src="scripts/lib/everlive.all.min.js"></script>
        <script src="scripts/lib/moment.min.js"></script>
        <script src="scripts/app/identity-provider.js"></script>        
        <script src="scripts/app/main.js" type="text/javascript"></script>
        
        
        <script type="text/javascript" charset="utf-8" src="scripts/jso.js"></script>
          
        
     

        
        
        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
        <link href="styles/main.css" rel="stylesheet" />
    </head>
    
    <body id="notesApp">
        <section data-role="layout" data-id="default">
            <!--View content will render here-->
        </section>
        <!--WELCOME VIEW -->
        <div data-role="view" id="welcome" data-layout="default" class="welcome-scrn form-view" data-model="app.viewModels.login">
            <h1><b>Leap</b><b>Car</b></h1>


            <ol class="group-wrp">
            <p>
                <img src="styles/images/sprite.png", width="260">
            </p>
                
                <li>
                    <span data-role="touch" data-bind="events: { tap: loginWithoutName }" style="display: inline-block">
                        <a data-role="button" class="btn-login-fb btn-big">Let's go !</a>
                    </span>                    
                </li>
            </ol>
                  <p>
                 Make: <select  id="idMake" class="myMake"></select>
                        
                    </p>
            
                    <p>
                        Model: <select  id="idModel" class="myModel"></select>
                        
                    </p>
            
                    <p>
                        Sub Model: <select  id="idSubModel" class="mySubModel"></select>
                        
                    </p>
            
                    <img name="car" id="carImage" width="300">
                       
  

        
                <a data-role="button" class="btn-login-fb btn-big" id="cmdLogin">Login</a>
                <a data-role="button" class="btn-login-fb btn-big" id="cmdPost">Post</a>
   
                <div class="results">
                    <div id="result" class="desc"></div>
                </div>      

     </div>     


        
        
        
<script>
    
var pic_url;
var item_fb;                                        
    
    
Array.prototype.getById = function(id)
{
    for (var i=0, len=this.length; i<len; i++) 
    {
            if (typeof this[i] != "object") continue;
            if (this[i].id == id) return this[i];
    }
}

var g_apikey = "ykbpsxywt4yqx3hyakgxhmev";


getMake();
    
    //getModels("Chevrolet");
    
function getModels(make)
{
    //$("<option>").html(" ").appendTo(".myModel");
    //var make_name = document.getElementById("idMake").selectedIndex;
    //alert(make_name);
    //var make = "BMW";
    var select = $("select").addClass("model single");
    jQuery.get("http://hearstcars.api.mashery.com/v1/api/vehicles/models-by-make/"+ make +"/json?api_key="+g_apikey, function(data) 
    {
        models = data.vehicles.models;
        makes = data.vehicles.makes;
        for (i in models)
        {
            var model = models[i];
            var make = makes.getById(model.make);
            if (typeof(make) != "undefined" && typeof(make.name) != "undefined")
            {
                $("<option>").addClass("model")
                             .attr("data-id", model.id)
                             .attr("data-name", model.name)
                             .attr("data-make", make.id)
                             .html(make.name + " " + model.name)
                             .appendTo(".myModel");
            }
        }
        $("<option>").html("").prependTo(".myModel");
    });
}
    
function getMake()
{
    $("<option>").html(" ").appendTo(".myMake");
    var select = $("select").addClass("model single");
    jQuery.get("http://hearstcars.api.mashery.com/v1/api/vehicles/makes/all/json?api_key="+g_apikey, function(data) 
    {
        makes = data.vehicles.makes;
        for (i in makes)
        {
            var make = makes[i];
            if (typeof(make) != "undefined" && typeof(make.name) != "undefined")
            {
                $("<option>").addClass("make")
                             .attr("data-name", make.id)
                             .attr("data-make", make.name)
                             .html(make.name)
                             .appendTo(".myMake");
            }
        }
        
    });
}
    
    
    
    function getSubModels(modelID)
    {
       
    var select = $("select").addClass("model single");
    jQuery.get("http://hearstcars.api.mashery.com/v1/api/vehicles/chrome-by-model/"+modelID+"/json?api_key="+ g_apikey, function(data)
    {
        models = data.submodels;
        makes = data.submodels.makes;
        for (i in models)
        {
            var model = models[i];
            var make = model.make;
            if (typeof(make) != "undefined")
            {
                $("<option>").addClass("model")
                             .attr("data-id", model.id)
                             .attr("data-name", model.name)
                             .attr("data-image", model.image)
                             .html(model.name)
                             .appendTo(".mySubModel");
            }
        }
        var found = [];
$("select option").each(function() {
  if($.inArray(this.value, found) != -1) $(this).remove();
  found.push(this.value);
});
         $("<option>").html("").prependTo(".mySubModel");
               });
        
               }
    
    
$(document).ready(function(){
  $('#idMake').change(function() {
      //alert('Handler for .change() called.');
      //alert($(this).val()); 
    $("#idModel option").remove();
      //$("#idModel option").html("").appendTo(".myModel");
      $("#idSubModel option").remove();
      //document.getElementById('carImage').disabled = true;
      $("#carImage").hide();
      //$("#idSubModel option").html("").appendTo(".mySubModel");
    getModels($(this).val());
      //var make_name = document.getElementById("idMake").selectedIndex;
      //alert(make_name);
  });
  $('#idModel').change(function() {
      //alert('Handler for .change() called.');
      var optionSelected = $(this).find('option:selected').attr('data-id');
      //alert(optionSelected);//this will show the value of the atribute of that option.
      //alert($(this).val());
      //alert($(this).val('data-id'));
    $("#idSubModel option").remove();
      $("#carImage").hide();
      //$("#idSubModel option").html("").appendTo(".mySubModel");
    getSubModels(optionSelected);
      
      //var make_name = document.getElementById("idMake").selectedIndex;
      //alert(make_name);
  });
     $('#idSubModel').change(function() {
      //alert('Handler for .change() called.');
      var optionSelected = $(this).find('option:selected').attr('data-image');
         //alert(optionSelected);//this will show the value of the atribute of that option.
        $("#carImage").show();
    var pic1 = document.getElementById("carImage"); 
    if (pic1 == typeof('undefined')) return;
    pic1.src = optionSelected;
    pic_url = optionSelected;
    item_fb = $(this).find('option:selected').attr('data-name');     
  });
    
  
    
});


var deviceready = function() {

    var debug = true,
        cmdLogin = document.getElementById("cmdLogin"),
        cmdWipe = document.getElementById("cmdWipe"),
        cmdPost = document.getElementById("cmdPost"),
     cmdGetFeed = document.getElementById("cmdGetFeed"),
        cmdDelete = document.getElementById("cmdDelete"),
        cmdClearLog = document.getElementById("cmdClearLog"),
        inAppBrowserRef;
    
    jso_registerRedirectHandler(function(url) {
        inAppBrowserRef = window.open(url, "_blank");
        inAppBrowserRef.addEventListener('loadstop', function(e){LocationChange(e.url)}, false);
    });

    /*
* Register a handler that detects redirects and
* lets JSO to detect incomming OAuth responses and deal with the content.
*/
    
    function LocationChange(url){
        outputlog("in location change");
        url = decodeURIComponent(url);
        outputlog("Checking location: " + url);

        jso_checkfortoken('facebook', url, function() {
            outputlog("Closing InAppBrowser, because a valid response was detected.");
            inAppBrowserRef.close();
        });
    };

    /*
* Configure the OAuth providers to use.
*/
    jso_configure({
        "facebook": {
            client_id: "172887179571181",
            redirect_uri: "http://www.facebook.com/connect/login_success.html",
            authorization: "https://www.facebook.com/dialog/oauth",
            presenttoken: "qs"
        }
    }, {"debug": debug});
    
    // jso_dump displays a list of cached tokens using outputlog if debugging is enabled.
    jso_dump();
    

    
 
    
    cmdLogin.addEventListener("click", function() {
        // For debugging purposes you can wipe existing cached tokens...
        outputlog("log in");
        jso_ensureTokens({
                "facebook": ["read_stream", "publish_stream"]
            });
    });
    
 
    cmdPost.addEventListener("click", function() {
        outputlog("Post to wall...");
        // Perform the protected OAuth calls.
        $.oajax({
            type: "POST",
            url: "https://graph.facebook.com/me/feed",
            jso_provider: "facebook",
            jso_scopes: ["read_stream", "publish_stream"],
            jso_allowia: true,
            dataType: 'json',
            data: {
                message: item_fb,
                //link: "http://icenium.com/?utm_source=facebook&utm_medium=post&utm_campaign=sampleapp",
                picture: pic_url
            },
            success: function(data) {
                outputlog("Post response (facebook):");
                outputlog(data);
            },
            error: function(e) {
                outputlog(e);
            }
        });
    });
};

function  outputlog(m) {
    var resultsField = document.getElementById("result");
    resultsField.innerText += typeof m === 'string' ? m : JSON.stringify(m);
    resultsField.innerText += '\n';
}

function outputclear(){
    var resultsField = document.getElementById("result");
    resultsField.innerText = "";
}

document.addEventListener('deviceready', this.deviceready, false);

//Activate :active state
document.addEventListener("touchstart", function() {}, false);

    
    
</script>
    
            

        
        
        
    </body>
    
</html>
